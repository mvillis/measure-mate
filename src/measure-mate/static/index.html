<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Measure Mate</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="js/classNames.js"></script>
    <script src="js/react-input-autosize.min.js"></script>
    <script src="js/react-select.min.js"></script>
        <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/default.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Measure Mate</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <h1>Time to Measure!</h1>
      <form role="form" onsubmit="window.location.href = 'assessment.html'; return false;">
        <div class="form-group" id="content"></div>
        <div class="form-group">
          <button class="btn btn-default" type="submit">Launch</button>
        </div>
      </form>
    </div>

    <script type="text/jsx">

    var TemplateSelect = React.createClass({
    	displayName: 'TemplateSelect',

      loadOptions: function loadOptions(input, callback) {
          setTimeout(function() {
              $.ajax({
                url: "/api/templates/",
                dataType: 'json',
                cache: true,
                success: function(data) {
                  var options = data.results.map(function (item) {
                    return (
                      { value: item.id, label: item.name }
                    );
                  });
                  callback(null, {
                      options: options,
                      complete: false
                  });
                },
                error: function(xhr, status, err) {
                  console.error(this.props.url, status, err.toString());
                }
              });
          }, 500);
      },

      logChange: function logChange(val) {
          console.log("Selected: " + val);
      },

    	render: function render() {
    		return React.createElement(
    			'div',
    			null,
    			React.createElement(
    				'label',
    				null,
    				this.props.label
    			),
    			React.createElement(Select, {
    				delimiter: ',',
    				multi: false,
            asyncOptions: this.loadOptions,
    				allowCreate: false,
    				placeholder: 'Type to filter templates',
    				onChange: this.logChange })
    		);
    	}
    });

    var TagSelect = React.createClass({
    	displayName: 'TagSelect',

      loadOptions: function loadOptions(input, callback) {
          setTimeout(function() {
              $.ajax({
                url: "/api/tags?search=" + input,
                dataType: 'json',
                cache: false,
                success: function(data) {
                  var options = data.results.map(function (item) {
                    return (
                      { value: item.id, label: item.name }
                    );
                  });
                  callback(null, {
                      options: options,
                      complete: false
                  });
                },
                error: function(xhr, status, err) {
                  console.error(this.props.url, status, err.toString());
                }
              });
          }, 500);
      },

      logChange: function logChange(val) {
          console.log("Selected: " + val);
      },

    	render: function render() {
    		return React.createElement(
    			'div',
    			null,
    			React.createElement(
    				'label',
    				null,
    				this.props.label
    			),
    			React.createElement(Select, {
    				delimiter: ',',
    				multi: true,
            asyncOptions: this.loadOptions,
    				allowCreate: true,
    				placeholder: 'Type to find existing tags or create new ones',
    				onChange: this.logChange })
    		);
    	}
    });

    React.render(React.createElement(
          'div',
          null,
          React.createElement(TemplateSelect, { label: 'Template' }),
    	    React.createElement(TagSelect, { label: 'Tags' })
        ),
      document.getElementById('content')
    );

    </script>
  </body>
</html>
