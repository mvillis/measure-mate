{% extends "base.html" %}

{% block title %}Measure Mate{% endblock %}
{% block head %}

{% endblock %}
{% block body %}
    <div class="container">
        <div class="jumbotron">
            <h1>Welcome to Measure Mate!</h1>
            <div class="container">
              <div id="content"></div>
            </div>

            <script type="text/jsx">

            var TemplateSelect = React.createClass({
              displayName: 'TemplateSelect',

              loadOptions: function loadOptions(input, callback) {
                  setTimeout(function() {
                      $.ajax({
                        url: "/api/templates/",
                        dataType: 'json',
                        cache: true,
                        success: function(data) {
                          var options = data.results.map(function (item) {
                            return (
                              { value: item.id, label: item.name }
                            );
                          });
                          callback(null, {
                              options: options,
                              complete: false
                          });
                        },
                        error: function(xhr, status, err) {
                          console.error(this.props.url, status, err.toString());
                        }
                      });
                  }, 500);
              },

              logChange: function logChange(val) {
                  console.log("Selected: " + val);
              },

              render: function render() {
                return React.createElement(
                  'div',
                  null,
                  React.createElement(
                    'label',
                    null,
                    this.props.label
                  ),
                  React.createElement(Select, {
                    delimiter: ',',
                    multi: false,
                    name: 'template',
                    asyncOptions: this.loadOptions,
                    allowCreate: false,
                    placeholder: 'Type to filter templates',
                    onChange: this.logChange })
                );
              }
            });

            var TagSelect = React.createClass({
              displayName: 'TagSelect',

              loadOptions: function loadOptions(input, callback) {
                  setTimeout(function() {
                      $.ajax({
                        url: "/api/tags?search=" + input,
                        dataType: 'json',
                        cache: false,
                        success: function(data) {
                          var options = data.results.map(function (item) {
                            return (
                              { value: item.id, label: item.name }
                            );
                          });
                          callback(null, {
                              options: options,
                              complete: false
                          });
                        },
                        error: function(xhr, status, err) {
                          console.error(this.props.url, status, err.toString());
                        }
                      });
                  }, 500);
              },

              logChange: function logChange(val) {
                  console.log("Selected: " + val);
              },

              render: function render() {
                return React.createElement(
                  'div',
                  null,
                  React.createElement(
                    'label',
                    null,
                    this.props.label
                  ),
                  React.createElement(Select, {
                    delimiter: ',',
                    multi: true,
                    asyncOptions: this.loadOptions,
                    allowCreate: true,
                    name: 'tags',
                    placeholder: 'Type to find existing tags or create new ones',
                    onChange: this.logChange }),
                    React.createElement(
                      'div',
                      { className: 'hint' },
                      'Tags are used to drive reporting. Use them to uniquely identify your area as well as group areas together.'
                    )
                );
              }
            });

            var AssessmentCreationForm = React.createClass({
              handleSubmit: function(e) {
                e.preventDefault();
                window.location.href = "/assessment";
                console.log("hello");
                var template = React.findDOMNode(this.refs.template);
                console.log(template);
                var tags = React.findDOMNode(this.refs.tags);
                console.log(tags);
              },
              render: function() {
                return (
                  <form className="assessmentCreationForm" onSubmit={this.handleSubmit}>
                    <TemplateSelect label= "Template" ref="template"/>
                    <TagSelect label= "Tags" ref="tags"/>
                    <input className="btn btn-default" type="submit" value="Launch" />
                  </form>
                );
              }
            });

            React.render(
              <AssessmentCreationForm />,
              document.getElementById('content')
            );

            </script>
        </div>
    </div>
{% endblock %}
